<%= render 'shared/header' %>

<div class="container" id="tasks_index">
	<div class="row">
		<div class="col-md-3">
			<%= render 'shared/sidebar' %>
		</div>
		<div class="col-md-9">
			<button class="btn btn-default"><span class="glyphicon glyphicon-plus" id="icon"></span><%= link_to ' Add new task', new_task_path(activity_id: params[:activity_id], project_id: params[:project_id]) %></button>
			<div id="tasks_accordion">
				<% @tasks.each do |task| %>
				  <h3><%= task.name %></h3>
				  <div>
				  	<button class="btn btn-default" style="float: right; margin-left:1%;">
					   	<span class="glyphicon glyphicon-pencil" id="icon"></span>
					  	<%= link_to " Edit task", edit_task_path(activity_id: params[:activity_id], project_id: params[:project_id], id: task.id) %>
				  	</button>
					  	<button class="btn btn-default" style="float: right;">
					   	<span class="glyphicon glyphicon-paperclip" id="icon"></span>
					  	<%= link_to " Add resources", new_task_upload_path(task) %>
				  	</button>
				  <span style="font-weight: bold;">Assigned to: <%= task.user.username %></span><br/>
				  	<span style="font-weight: bold;">Description: </span><%= task.description %><br/>
				  	<span style="font-weight: bold;">Duration: </span><%= task.duration %><span> hours</span><br/>
				  	<span style="font-weight: bold;">Deadline: </span><%= task.deadline.to_formatted_s(:long) %><br/>
				  	<span style="font-weight: bold;">Progress status: </span><%= task.status %><span> %</span><br/>
				  	<span style="font-weight: bold;">Created at: </span><%= task.created_at.to_formatted_s(:short)  %><br/>
				  	<span style="font-weight: bold;">Updated at: </span><%= task.updated_at.to_formatted_s(:short) %><br/>

				  	<span style="font-weight: bold;">Resources: </span><br>
				  	<% task.uploads.each do |upload| %>
				  		<%= link_to upload.filename, task_upload_path(task, upload) %><br>
				  	<% end %>

				  	<div>
					  	<span class='icon'> | </span>
					  	<button id='toggle_comments'><span class='glyphicon glyphicon-comment'></span> Comments (<%= task.comments.count %>)</button>
					  	<br/><br/>
				  	</div>

				  	<div id='comments_list'>
				  		<% task.comments.each do |comm| %>
				  			<div class="comment">
				  				<span><%= comm.content %><br/>
				  				<span class="gray">by <%= comm.user.username %> at <%= comm.created_at.to_formatted_s(:long) %></span>
				  			</div>
				  		<% end %>
				  	</div>

				  	<%= form_tag (tasks_path()), class: 'add_comment_form' do %>
				  		<div class="form-group">
						    <label for="content">Comment</label>
						    <input type="text" class="form-control" id="content" placeholder="Username" name="content">
						  </div>
    					<span class='icon'> | </span>
					  	<button type="submit"><span class='glyphicon glyphicon-plus'></span> 
					  	<%= link_to ' Add your comment', task_comments_path(activity_id: params[:activity_id], task_id: task.id, user_id: @current_user.id), :method => :create %><br>
					  	</button>
				  	<% end %>


				  </div>
			  <% end %>
			</div>
		</div>
	</div>
<div>